<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>悬赏管理</title>
    <!-- 引入 layui.css -->
    <link href="//cdn.staticfile.org/layui/2.9.3/css/layui.css" rel="stylesheet">
    <!-- 引入 layui.js -->
    <script src="//cdn.staticfile.org/layui/2.9.3/layui.js"></script>
</head>

<body>
    <!-- 定义页面布局 -->
    <div class="layui-layout layui-layout-admin">

        <!-- 头部 -->
        <div class="layui-header">
            <!-- 头部内容 -->
            <div class="layui-logo">悬赏管理</div>
            <ul class="layui-nav layui-layout-left">
                <!-- 头部左侧菜单 -->
                <li class="layui-nav-item"><a href="{{ url_for('index1', Username=session['username'])}}">回到主页</a></li>
            </ul>
            <!-- 头部右侧菜单 -->
            <ul class="layui-nav layui-layout-right">
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <!-- 头部右侧菜单内容 -->
                        {{ session['username'] }}
                    </a>
                    <dl class="layui-nav-child">
                        <!-- 子菜单项 -->
                        <dd><a href="{{ url_for('modify_mima') }}">Change Password</a></dd>
                        <dd><a href="{{ url_for('user_sign_out') }}">Sign out</a></dd>
                    </dl>
                </li>
            </ul>
        </div>

        <!-- 左侧菜单 -->
        <div class="layui-side layui-bg-black">
            <!-- 左侧菜单内容 -->
            <div class="layui-side-scroll">
                <ul class="layui-nav layui-nav-tree" lay-filter="test">
                    <li class="layui-nav-item"><a href="{{ url_for('user_reward_manage') }}">全部悬赏</a></li>
                    <li class="layui-nav-item layui-this">我的悬赏</li>
                    <li class="layui-nav-item"><a href="/user_reward_manage/pending_review/">待审核的悬赏</a></li>
                </ul>
            </div>
        </div>

        <!-- 主体内容区域 -->
        <div class="layui-body">
            <!-- 主体内容 -->
            <div style="padding: 16px;">
                <table class="layui-hide" id="content" lay-filter="test"></table>
            </div>
        </div>

        <!-- 底部 -->
        <div class="layui-footer">
            <!-- 底部内容 -->
            &copy; 2024 FaceCompare
        </div>

    </div>

    <!-- 表格工具栏 -->
    <script type="text/html" id="tableToolbar">
        <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm" lay-event="deleteReward">删除选中悬赏</button>
            <button class="layui-btn layui-btn-sm" lay-event="addReward">添加悬赏</button>
        </div>
    </script>

    <!-- 表头工具栏 -->
    <script type="text/html" id="headToolbar">
        <div class="layui-clear-space">
            <a class="layui-btn layui-btn-xs" lay-event="see">查看图片</a>
            <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
        </div>
    </script>


    <!-- 加载模块 -->
    <script type="text/javascript">
        layui.use(['table', 'layer', 'jquery'], function(){
            var table = layui.table;
            var layer = layui.layer;
            var $ = layui.jquery;

            table.render({
                elem: "#content",
                url: "/static/json/reward_data.json",
                cols:[[
                    {field: 'aa', type: 'numbers'},
                    {field: 'aa', type: 'checkbox'},
                    {field: 'name', title: '姓名', width: 100},
                    {field: 'age', title: '年龄', width: 90},
                    {field: 'province', title: '地址', width: 500},
                    {field: 'price', title: '悬赏', width: 100, sort: true},
                    {field: 'operation', toolbar: '#headToolbar'},
                ]],
                page: true,
                // 设置表格工具栏
                toolbar: '#tableToolbar',
            });

            /*
                表头工具栏监听事件
             */
            table.on('toolbar(test)', function(obj){
                var checkStatus = table.checkStatus(obj.config.id);
                var eventName = obj.event;
                console.log(checkStatus);
                if (eventName == "deleteReward") { // 删除悬赏
                    layer.confirm("您确定要删除吗？", function(index){
                        // $.ajax({
                        //     type: "POST",
                        //     url: "/user_delete_reward",
                        //     contentType: "application/json;charset=UTF-8",
                        //     data: JSON.stringify({
                        //         selectedData: checkStatus.data
                        //     }),
                        //     success: function(data){
                        //
                        //     },
                        //     error: function(){
                        //
                        //     }
                        // });

                        var selectedData = checkStatus.data;
                        // 删除选中的行
                        for (var i = 0; i < selectedData.length; i++) {
                            table.reload('content', {
                                url: '/user_delete_reward',  // 后端删除数据的接口
                                method: 'POST',
                                where: {
                                    // 向后端传递删除操作所需的数据
                                    pictureid: selectedData[i].pictureid  // 假设每行数据有一个id字段
                                },
                                done: function(res){
                                    // 删除成功的回调
                                    if (res.msg === 'success') {
                                        layer.msg('删除成功');
                                    } else {
                                        window.location.href = '/user_reward_manage/my_reward';
                                        layer.msg('删除失败');
                                    }
                                }
                            });
                        }
                        layer.close(index)
                    });
                } else if (eventName == "addReward") { // 添加悬赏

                }
            });

            /*
                监听行工具栏事件
             */
            table.on('tool(test)', function(obj){

            });
        });
    </script>
</body>

</html>